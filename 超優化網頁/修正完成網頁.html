
<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>113åˆ†ç§‘æ›ç®—å·¥å…·</title>
<style>
        body {
            font-family: 'Arial', 'Helvetica Neue', Helvetica, sans-serif;
            background-color: #f7f9fc;
            color: #333333;
            padding: 20px;
            margin: 0;
            text-align: center;
        }
        h1 {
            color: #4a90e2;
            font-size: 32px;
        }
        h2 {
            color: #333333;
            font-size: 24px;
        }
        .subtitle {
            color: #666;
            font-size: 16px;
        }
        input, select, button {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, button:hover {
            border-color: #4a90e2;
            box-shadow: 0 0 8px rgba(74,144,226,0.4);
            outline: none;
        }
        .card {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 900px;
        }
        .results {
            background-color: #eaf4fe;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .flex-center {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        button {
            background-color: #4a90e2;
            color: white;
            cursor: pointer;
        }
        button.clear-btn {
            background-color: #d9534f;
        }
    </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script></head>
<body>
<h1>113åˆ†ç§‘æ›ç®—å·¥å…·</h1>
<div class="subtitle">å¿«é€Ÿè©•ä¼°ä½ çš„å‡å­¸æ©Ÿæœƒ</div>
<div class="card">
<h2>å­¸æ¸¬æˆç¸¾è¼¸å…¥</h2>
<div class="flex-center" id="score-inputs">
<div>åœ‹æ–‡<input id="åœ‹æ–‡" max="15" min="0" oninput="updateScore('åœ‹æ–‡')" type="number"/><div class="score-display" id="display-åœ‹æ–‡"></div></div>
<div>è‹±æ–‡<input id="è‹±æ–‡" max="15" min="0" oninput="updateScore('è‹±æ–‡')" type="number"/><div class="score-display" id="display-è‹±æ–‡"></div></div>
<div>æ•¸A<input id="æ•¸A" max="15" min="0" oninput="updateScore('æ•¸A')" type="number"/><div class="score-display" id="display-æ•¸A"></div></div>
<div>æ•¸B<input id="æ•¸B" max="15" min="0" oninput="updateScore('æ•¸B')" type="number"/><div class="score-display" id="display-æ•¸B"></div></div>
<div>ç¤¾æœƒ<input id="ç¤¾æœƒ" max="15" min="0" oninput="updateScore('ç¤¾æœƒ')" type="number"/><div class="score-display" id="display-ç¤¾æœƒ"></div></div>
<div>è‡ªç„¶<input id="è‡ªç„¶" max="15" min="0" oninput="updateScore('è‡ªç„¶')" type="number"/><div class="score-display" id="display-è‡ªç„¶"></div></div>
</div>
</div>
<div class="card">
<h2>æ ¡ç³»è¨­å®š</h2>
<select id="yearList" onchange="updateSchools()">
<option value="">é¸æ“‡å¹´åº¦</option>
</select>
<select id="schoolList" onchange="updateDepartments()">
<option value="">é¸æ“‡å¤§å­¸æ ¡å</option>
</select>
<select id="departmentList" onchange="displayDepartmentDetails()">
<option value="">é¸æ“‡ç§‘ç³»åç¨±</option>
</select>
<div id="departmentResults"></div>
<button onclick="addToEvaluation()">åŠ å…¥è©•ä¼°</button>
</div><div class="card">
<h2>è©•ä¼°æ¸…å–® (æœ€å¤š10å€‹)</h2>
<div id="evaluationList"></div>
</div>
<button onclick="calculateAll()">è¨ˆç®—å…¨éƒ¨æ ¡ç³»</button>
<button class="clear-btn" onclick="clearInputs()">ä¸€éµæ¸…é™¤è³‡æ–™</button>
<button onclick="window.scrollTo({top: 0, behavior: 'smooth'})">è¿”å›é ‚ç«¯</button>
<div class="results" id="results"></div>
<button onclick="generateReport()">ç”¢ç”Ÿå ±è¡¨</button>
<div class="card" id="reportResults" style="margin-top:20px;"></div><div style="text-align:center; margin-top:40px; padding:15px; background-color:#f0f4f8; border-radius:8px; font-size:14px; color:#555;"><div>ç¶²é ç™¼æƒ³ï¼šåƒæŒæ»´ç¶²è·¯æ•™å®¤</div><div><a href="https://open.firstory.me/user/believekensheng/platforms" style="color:#4a90e2; text-decoration:none;" target="_blank">æ”¶è½é€£çµï¼šé»æ­¤å‰å¾€</a></div><div>ç¶²é è£½ä½œï¼šChatGPT</div></div><div id="visitCounter" style="text-align:center; margin-top:20px; padding:10px; font-size:14px; color:#333;">ç¶²é ä½¿ç”¨æ¬¡æ•¸ï¼šè¼‰å…¥ä¸­...</div><script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script><script>
let csvData;
let evaluationData = [];

Papa.parse("111_112_113_åˆä½µå€ç‡è³‡æ–™.csv", {
    download: true,
    header: true,
    complete: function(results) {
        csvData = results.data;
        initializeYearList();
    }
});

function initializeYearList() {
    let years = [...new Set(csvData.map(d => d['å¹´åº¦']).filter(year => year))];
    let yearList = document.getElementById('yearList');
    yearList.innerHTML = '<option value="">é¸æ“‡å¹´åº¦</option>';
    years.forEach(year => {
        yearList.innerHTML += `<option value="${year}">${year}</option>`;
    });
}

function updateSchools() {
    let year = document.getElementById('yearList').value;
    let schools = [...new Set(csvData.filter(d => d['å¹´åº¦'] === year).map(d => d['æ ¡å']))];
    let schoolList = document.getElementById('schoolList');
    schoolList.innerHTML = '<option value="">é¸æ“‡å¤§å­¸æ ¡å</option>';
    schools.forEach(school => {
        schoolList.innerHTML += `<option value="${school}">${school}</option>`;
    });
    document.getElementById('departmentList').innerHTML = '<option value="">é¸æ“‡ç§‘ç³»åç¨±</option>';
}

function updateDepartments() {
    let year = document.getElementById('yearList').value;
    let school = document.getElementById('schoolList').value;
    let departments = csvData.filter(d => d['å¹´åº¦'] === year && d['æ ¡å'] === school);
    let departmentList = document.getElementById('departmentList');
    departmentList.innerHTML = '<option value="">é¸æ“‡ç§‘ç³»åç¨±</option>';
    departments.forEach((dept, index) => {
        departmentList.innerHTML += `<option value='${index}'>${dept['ç³»çµ„å']}</option>`;
    });
}

function displayDepartmentDetails() {
    let index = document.getElementById('departmentList').value;
    if (index === '') return;

    let year = document.getElementById('yearList').value;
    let school = document.getElementById('schoolList').value;
    let departments = csvData.filter(d => d['å¹´åº¦'] === year && d['æ ¡å'] === school);
    let deptData = departments[index];

    if (!deptData) return;

    let html = `<div class="card dept">
        <div><strong>æ ¡ç³»åç¨±:</strong> ${deptData['æ ¡å']} ${deptData['ç³»çµ„å']}</div>`;

    let subjects = ["åœ‹å€ç‡", "è‹±å€ç‡", "æ•¸Aå€ç‡", "æ•¸Bå€ç‡", "ç¤¾æœƒå€ç‡", "è‡ªç„¶å€ç‡", "æ•¸ç”²å€ç‡", "ç‰©å€ç‡", "åŒ–å€ç‡", "ç”Ÿå€ç‡", "æ­·å€ç‡", "åœ°å€ç‡", "å…¬å€ç‡"];

    html += `<div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:10px;">`;
    subjects.forEach(sub => {
        let weight = deptData[sub] || 0;
        html += `<div>${sub}: ${weight}</div>`;
    });
    html += `</div>`;

    html += `<div style="margin-top:10px;"><strong>æœ€ä½éŒ„å–åˆ†æ•¸:</strong> ${deptData['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']} / éŒ„å–äººæ•¸: ${deptData['éŒ„å–äººæ•¸']}</div></div>`;

    document.getElementById('departmentResults').innerHTML = html;
}

function addToEvaluation() {
    if(evaluationData.length >= 10) {
        alert("æœ€å¤šåªèƒ½è©•ä¼°10å€‹æ ¡ç³»ã€‚");
        return;
    }
    let index = document.getElementById('departmentList').value;
    if (index === '') return;

    let year = document.getElementById('yearList').value;
    let school = document.getElementById('schoolList').value;
    let departments = csvData.filter(d => d['å¹´åº¦'] === year && d['æ ¡å'] === school);
    let deptData = departments[index];

    evaluationData.push(deptData);
    renderEvaluationList();
}

function removeEvaluation(index) {
    evaluationData.splice(index, 1);
    renderEvaluationList();
}

function renderEvaluationList() {
    let listHtml = "";
    evaluationData.forEach((dept, idx) => {
        listHtml += `<div>${idx+1}. ${dept['æ ¡å']} ${dept['ç³»çµ„å']} (${dept['å¹´åº¦']}) 
        <button onclick="removeEvaluation(${idx})">ç§»é™¤</button><br>
        åœ‹å€ç‡: ${dept['åœ‹å€ç‡']}, è‹±å€ç‡: ${dept['è‹±å€ç‡']}, æ•¸Aå€ç‡: ${dept['æ•¸Aå€ç‡']}, æ•¸Bå€ç‡: ${dept['æ•¸Bå€ç‡']}, ç¤¾æœƒå€ç‡: ${dept['ç¤¾æœƒå€ç‡']}, è‡ªç„¶å€ç‡: ${dept['è‡ªç„¶å€ç‡']}<br>
        æ•¸ç”²å€ç‡: ${dept['æ•¸ç”²å€ç‡']}, ç‰©å€ç‡: ${dept['ç‰©å€ç‡']}, åŒ–å€ç‡: ${dept['åŒ–å€ç‡']}, ç”Ÿå€ç‡: ${dept['ç”Ÿå€ç‡']}, æ­·å€ç‡: ${dept['æ­·å€ç‡']}, åœ°å€ç‡: ${dept['åœ°å€ç‡']}, å…¬å€ç‡: ${dept['å…¬å€ç‡']}<br>
        æœ€ä½åˆ†æ•¸: ${dept['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']} / éŒ„å–äººæ•¸: ${dept['éŒ„å–äººæ•¸']}</div><hr>`;
    });
    document.getElementById('evaluationList').innerHTML = listHtml;
}
</script>
<script>
function calculateAll() {
    if(evaluationData.length === 0) {
        alert('è«‹å…ˆåŠ å…¥æ ¡ç³»è‡³è©•ä¼°æ¸…å–®ï¼');
        return;
    }

    let resHTML = '';
    evaluationData.forEach((dept) => {
        let minSum = 0, maxSum = 0, weightSum = 0;
        let subjectsMapping = {"åœ‹å€ç‡":"åœ‹æ–‡","è‹±å€ç‡":"è‹±æ–‡","æ•¸Aå€ç‡":"æ•¸A","æ•¸Bå€ç‡":"æ•¸B","ç¤¾æœƒå€ç‡":"ç¤¾æœƒ","è‡ªç„¶å€ç‡":"è‡ªç„¶"};
        let extraSubjectsMapping = ["æ•¸ç”²å€ç‡","ç‰©å€ç‡","åŒ–å€ç‡","ç”Ÿå€ç‡","æ­·å€ç‡","åœ°å€ç‡","å…¬å€ç‡"];

        Object.entries(subjectsMapping).forEach(([csvSub, pageSub]) => {
            let scores = JSON.parse(document.getElementById(pageSub).dataset.score || '{"max":0,"min":0}');
            let weight = parseFloat(dept[csvSub]) || 0;
            minSum += scores.max * weight;
            maxSum += scores.min * weight;
        });

        extraSubjectsMapping.forEach(sub => {
            let weight = parseFloat(dept[sub]) || 0;
            weightSum += weight;
        });

        let minscore = parseFloat(dept['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']) || 0;

        let minRequired = (minscore - minSum) / (weightSum || 1);
        let maxRequired = (minscore - maxSum) / (weightSum || 1);
        
        let name = dept['æ ¡å'] + " " + dept['ç³»çµ„å'];
        
        resHTML += `<div><strong>${name}</strong> è¨ˆç®—çµæœï¼š<br>
                    åˆ†ç§‘å–®ç§‘æ‰€éœ€æœ€ä½å¹³å‡ç´šåˆ†: ${minRequired.toFixed(2)}<br>
                    åˆ†ç§‘å–®ç§‘æ‰€éœ€æœ€é«˜å¹³å‡ç´šåˆ†: ${maxRequired.toFixed(2)}</div><hr>`;
    });
    document.getElementById('results').innerHTML = resHTML;
}

function generateReport() {
    if(evaluationData.length === 0) {
        alert('è«‹å…ˆåŠ å…¥æ ¡ç³»è‡³è©•ä¼°æ¸…å–®ï¼');
        return;
    }

    let reportHTML = '<h2>ğŸ“‘ å ±è¡¨çµæœ</h2><div class="card">';

    reportHTML += '<h3>ä¸€ã€å­¸æ¸¬æˆç¸¾èˆ‡è½‰æ›åˆ†æ•¸</h3>';
    ["åœ‹æ–‡","è‹±æ–‡","æ•¸A","æ•¸B","ç¤¾æœƒ","è‡ªç„¶"].forEach(function(sub) {
        let inputVal = document.getElementById(sub).value || 0;
        let score = JSON.parse(document.getElementById(sub).dataset.score || '{"max":0,"min":0}');
        reportHTML += `<p>${sub}: åŸå§‹æˆç¸¾ ${inputVal}, è½‰æ›å¾Œæœ€ä½åˆ†: ${score.min}, è½‰æ›å¾Œæœ€é«˜åˆ†: ${score.max}</p>`;
    });

    reportHTML += '<h3>äºŒã€æ ¡ç³»å®Œæ•´è³‡æ–™</h3>';
    reportHTML += '<table style="width:100%; border-collapse:collapse; margin-top:10px;" border="1"><tr style="background-color:#4a90e2; color:white;"><th>æ ¡ç³»åç¨±</th><th>ç¯©é¸ç§‘ç›®èˆ‡å€ç‡(é0)</th><th>æœ€ä½éŒ„å–åˆ†æ•¸</th><th>éŒ„å–äººæ•¸</th></tr>';

    evaluationData.forEach(dept => {
        let subjects_weights = "";
        ["åœ‹å€ç‡","è‹±å€ç‡","æ•¸Aå€ç‡","æ•¸Bå€ç‡","ç¤¾æœƒå€ç‡","è‡ªç„¶å€ç‡","æ•¸ç”²å€ç‡","ç‰©å€ç‡","åŒ–å€ç‡","ç”Ÿå€ç‡","æ­·å€ç‡","åœ°å€ç‡","å…¬å€ç‡"].forEach(sub => {
            let weight = dept[sub] || 0;
            if (parseFloat(weight) !== 0) {
                subjects_weights += `${sub}: ${weight}ã€€`;
            }
        });

        let name = dept['æ ¡å'] + " " + dept['ç³»çµ„å'];
        reportHTML += `<tr><td>${name}</td><td>${subjects_weights}</td><td>${dept['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']}</td><td>${dept['éŒ„å–äººæ•¸']}</td></tr>`;
    });

    reportHTML += '</table></div>';
    document.getElementById('reportResults').innerHTML = reportHTML;
}
</script>
</body>
</html>
